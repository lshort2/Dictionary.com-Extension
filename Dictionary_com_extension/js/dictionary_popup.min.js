$(document).ready(function(){$('input#dic-word').keypress(function(e){if(e.which==13){getPopupDefinitions()}else{$('div#content').attr('fetching',false)}});$('div#dic-word-define-btn').click(function(e){getPopupDefinitions()});$('a#dic_options').click(function(){chrome.extension.sendRequest({action:'getOptions'},function(response){});return false})});function getPopupDefinitions(){if($('div#content').attr('fetching')){return}var defineWord=trim($('input#dic-word').val());var remPuncation=defineWord.replace(/\b[-.,;()&$#!\[\]{}]+\B|\B[-.,;()&$#!\[\]{}]+\b/g,"");defineWord=remPuncation;if(defineWord.length>0&&defineWord!='Search'){var word=defineWord.indexOf(" ");if(word!=-1){defineWord=defineWord.replace(/definitions of/i,"").replace(/definition of/i,"").replace(/definitions/i,"").replace(/define/i,"").replace(/definition/i,"");defineWord=defineWord.replace(/meaning of/i,"").replace(/meaning/i,"").replace(/means/i,"");defineWord=defineWord.replace(/what is/i,"")}defineWord=trim(defineWord);var apostrophy=defineWord.indexOf("'");if(apostrophy!=-1){defineWord=defineWord.substring(0,apostrophy)}$('div#content').attr('fetching',true);var displayWord=defineWord;var speaker=chrome.extension.getURL("images/Audioicon.png");var loading=chrome.extension.getURL("images/ajax-loader.gif");var dic_logo=chrome.extension.getURL("images/dic_logo.png");var dic_close_btn=chrome.extension.getURL("images/closeIcon.png");var dic_more=chrome.extension.getURL("images/more.png");var loader=' <img src="'+loading+'" style="padding:15px 0 15px 170px">';$('#dic_lookup_defintion').html(loader);$('#dic_lookup_defintion').show();$('#dic_tip').hide();var synonyms='';var dicRestAPISynonymsURL="http://restapi.dictionary.com/v2/word.json/"+defineWord+"/synonyms?api_key=sWq3tLz8ifndaTK&platform=Chrome&app_id=chromeExtension_1.1";$.ajax({type:"GET",url:dicRestAPISynonymsURL,dataType:"json",success:function(synonymsJSON){if(synonymsJSON.synonyms.length>0){for(var i=0;i<synonymsJSON.synonyms.length;i++){if(i<10){var linkedUrl="/browse/"+synonymsJSON.synonyms[i];synonyms=synonyms+'<a href="'+linkedUrl+'">'+synonymsJSON.synonyms[i]+'</a>, '}}var lastIndex=synonyms.lastIndexOf(",");synonyms=synonyms.substring(0,lastIndex)}},error:function(xhr,ajaxOptions,thrownError){console.log("unable to find out this word.");}});var dicRestAPIURL="http://restapi.dictionary.com/v2/word.json/"+defineWord+"/complete?api_key=sWq3tLz8ifndaTK&platform=Chrome&app_id=chromeExtension_1.1&clickSource=Extended definition";$.ajax({type:"GET",url:dicRestAPIURL,dataType:"json",success:function(response){$('div#content').attr('fetching',false);if(response.entries.length>0){var nounHtml=$('<div class="dic_definitions_content">'+' <div class="selection_popup_word" id="selection_popup_word"></div>'+' <div id="dic_difinition">'+' </div>'+' <div id="dic_synonyms">'+' </div>'+'</div>');$('#dic_lookup_defintion').html(nounHtml);var count=0;var itemCunt=1;var dataEntries=response.entries;var selectionFound=false;var foundDefintion=false;var dataEntry=null;for(var i=0;i<dataEntries.length;i++){if(dataEntries[i].entry==defineWord){dataEntry=dataEntries[i];selectionFound=true}if(selectionFound){break}}if(dataEntry==null){dataEntry=dataEntries[0]}if(dataEntry!=null){$('<span style="padding-right:10px;"></span>').html(displayWord).appendTo('#selection_popup_word');if(dataEntry.audio_file!=null){var audiovar="http://sp.dictionary.com/dictstatic/dictionary/audio/luna/"+dataEntry.audio_file+".mp3";var speakerDom='<img style="position: relative;top: 4px;display:inline;cursor:pointer;" src="'+speaker+'" id="playPopupSound">';$('<span style="font-size:12px;"></span>').html(speakerDom).appendTo('#selection_popup_word');$('#playPopupSound').click(function(){var embedDom='<embed src="'+audiovar+'" hidden=true autostart=true loop=false>';$('#soundPopupBox').html(embedDom)})}if(dataEntry.pronunciation_spell!=null){var pron="[<span style='padding-right:2px;'> "+dataEntry.pronunciation_spell+"</span>]";$('<span class="selection_popup_align_with_speaker"></span>').html(pron).appendTo('#selection_popup_word')}$('<span id="soundPopupBox"></span>').appendTo('#selection_popup_word');for(var type in dataEntry.definitions){count=0;itemCunt=1;definitionType=type;defintionsDisplay=dataEntry.definitions[definitionType];defintionLength=dataEntry.definitions[definitionType].length;if(defintionLength!=0){var contentDisplay='';for(var j=0;j<defintionLength;j++){if(count!=5){var definitionContent=null;var contentWithHover=null;var contentWithHoverSplit=null;var contentWithHoverDom=null;var contentWithHoverChildDom=null;if(defintionsDisplay[j].definition){contentWithHover=defintionsDisplay[j].definition.content;contentWithHoverDom=$("<div></div>").html(contentWithHover);contentWithHoverChildDom=contentWithHoverDom[0].childNodes;definitionContent="<div class='item'><div class='itemCount'>"+itemCunt+".</div><div class='itemData'>";for(var n=0;n<contentWithHoverChildDom.length;n++){if(contentWithHoverChildDom[n].nodeName=='#text'){contentWithHoverSplit=contentWithHoverChildDom[n].nodeValue.split(" ");for(var m=0;m<contentWithHoverSplit.length;m++){definitionContent=definitionContent+" "+"<span style=color: rgb(51, 51, 51); cursor: default;  onmouseover=this.style.color='#0055bb';this.style.cursor='pointer' onmouseout=this.style.color='#333333';this.style.cursor='default' >"+contentWithHoverSplit[m]+"</span>"}}else{definitionContent=definitionContent+contentWithHoverChildDom[n].innerHTML}}definitionContent=definitionContent+"</div></div>";if(contentDisplay==''){contentDisplay=definitionContent}else{contentDisplay=contentDisplay+definitionContent}count=count+1;itemCunt=itemCunt+1}else if(defintionsDisplay[j].definitions){for(var k=0;k<defintionsDisplay[j].definitions.length;k++){if(count!=5){contentWithHover=defintionsDisplay[j].definitions[k].content;contentWithHoverDom=$("<div></div>").html(contentWithHover);contentWithHoverChildDom=contentWithHoverDom[0].childNodes;definitionContent="<div class='item'><div class='itemCount'>"+itemCunt+".</div><div class='itemData'>";for(var n=0;n<contentWithHoverChildDom.length;n++){if(contentWithHoverChildDom[n].nodeName=='#text'){contentWithHoverSplit=contentWithHoverChildDom[n].nodeValue.split(" ");for(var m=0;m<contentWithHoverSplit.length;m++){definitionContent=definitionContent+" "+"<span style=color: rgb(51, 51, 51); cursor: default;  onmouseover=this.style.color='#0055bb';this.style.cursor='pointer' onmouseout=this.style.color='#333333';this.style.cursor='default' >"+contentWithHoverSplit[m]+"</span>"}}else{definitionContent=definitionContent+contentWithHoverChildDom[n].innerHTML}}definitionContent=definitionContent+"</div></div>";if(contentDisplay==''){contentDisplay=definitionContent}else{contentDisplay=contentDisplay+definitionContent}count=count+1;itemCunt=itemCunt+1}}}}if(count==5){break}}var contentDiv='<div class="selection_popup_title">'+definitionType+'</div>'+' <div id="dic_dif" class="dic_dif">'+contentDisplay+' </div>';$('#dic_difinition').append(contentDiv)}}}if(synonyms.length>10){var dicSynonyms=' <div class="selection_popup_synonyms">synonyms</div>'+' <div id="selection_popup_defintion"></div>';$('#dic_synonyms').html(dicSynonyms);$('<span></span>').html(synonyms).appendTo('#selection_popup_defintion');$('div#selection_popup_defintion span a').click(function(){var href=$(this).attr('href');chrome.extension.sendRequest({action:'redirectUrl',href:href},function(response){});return false})}if(itemCunt!=0){var moreBtn='<a href="http://app.dictionary.com/click/3zd8ha?clkdest=http://dictionary.com/browse/'+defineWord+'" target="_blank">'+'	<img  src="'+dic_more+'"  alt="Dictionary More"/>'+'	</a>';$('<div></div>').css({'padding':'15px 0 0px 10px'}).html(moreBtn).appendTo('#dic_synonyms')}}else{var dicRestAPIspellSuggestionsURL="http://restapi.dictionary.com/v2/word.json/"+defineWord+"/spellSuggestions?api_key=sWq3tLz8ifndaTK&platform=Chrome&app_id=chromeExtension_1.1&clickSource=Extended Suggestions";var suggestion='<div style="width:120px;float:left;padding-left:10px;"><b>Did you mean:</b></div><div style="float:left;line-height:20px;">';var nounHtml='<div class="dic_definitions_content" id="suggestions">'+' <div id="dic_difinition">'+'<div style="padding:10px;"><b>No dictionary results found for</b> '+defineWord+':</div>';$.ajax({type:"GET",url:dicRestAPIspellSuggestionsURL,dataType:"json",success:function(suggestionsJSON){if(suggestionsJSON.spellSuggestions.length>0){for(var i=0;i<suggestionsJSON.spellSuggestions.length;i++){var linkedUrl="/browse/"+suggestionsJSON.spellSuggestions[i];if(i<7){suggestion=suggestion+'<div><a style="color:#12C;font-size:12px;" href="'+linkedUrl+'">'+suggestionsJSON.spellSuggestions[i]+'</a></div>'}}suggestion=suggestion+"</div>"}var mainhref='<a style="color:#12C;font-size:12px;" href=/browse/'+defineWord+'>results for '+defineWord+'</a>';suggestion=suggestion+"<div style='clear:both;padding:10px;'>See "+mainhref+" on Reference.com</div>";nounHtml=nounHtml+suggestion+' </div></div>';$('#dic_lookup_defintion').html(nounHtml);$('div#suggestions a').click(function(){var href=$(this).attr('href');chrome.extension.sendRequest({action:'getReference',href:href},function(response){});return false})},error:function(xhr,ajaxOptions,thrownError){nounHtml=nounHtml+' </div></div>';$('#dic_lookup_defintion').html(nounHtml)}})}$('.itemData a').click(function(){var popHref=$(this).attr("href");chrome.extension.sendRequest({action:'redirectUrl',href:popHref},function(response){});return false});$('.itemData').dblclick(function(){$('input#dic-word').val(window.getSelection());getPopupDefinitions();return false})},error:function(xhr,ajaxOptions,thrownError){var dicRestAPIspellSuggestionsURL="http://restapi.dictionary.com/v2/word.json/"+defineWord+"/spellSuggestions?api_key=sWq3tLz8ifndaTK&platform=Chrome&app_id=chromeExtension_1.1&clickSource=Extended Suggestions";var suggestion='<div style="width:120px;float:left;padding-left:10px;"><b>Did you mean:</b></div><div style="float:left;line-height:20px;">';var nounHtml='<div class="dic_definitions_content" id="suggestions">'+' <div id="dic_difinition">'+'<div style="padding:10px;"><b>No dictionary results found for</b> '+defineWord+':</div>';$.ajax({type:"GET",url:dicRestAPIspellSuggestionsURL,dataType:"json",success:function(suggestionsJSON){if(suggestionsJSON.spellSuggestions.length>0){for(var i=0;i<suggestionsJSON.spellSuggestions.length;i++){var linkedUrl="/browse/"+suggestionsJSON.spellSuggestions[i];if(i<7){suggestion=suggestion+'<div><a style="color:#12C;font-size:12px;" href="'+linkedUrl+'">'+suggestionsJSON.spellSuggestions[i]+'</a></div>'}}suggestion=suggestion+"</div>"}var mainhref='<a style="color:#12C;font-size:12px;" href=/browse/'+defineWord+'>results for '+defineWord+'</a>';suggestion=suggestion+"<div style='clear:both;padding:10px;'>See "+mainhref+" on Reference.com</div>";nounHtml=nounHtml+suggestion+' </div></div>';$('#dic_lookup_defintion').html(nounHtml);$('div#suggestions a').click(function(){var href=$(this).attr('href');chrome.extension.sendRequest({action:'getReference',href:href},function(response){});return false})},error:function(xhr,ajaxOptions,thrownError){nounHtml=nounHtml+' </div></div>';$('#dic_lookup_defintion').html(nounHtml)}})}})}}function trim(word){return word.replace(/^\s+|\s+$/g,'')}